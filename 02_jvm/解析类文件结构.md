# 解析类文件结构

## 整体类文件结构

```yml
ClassFile {
    u4             magic;
    u2             minor_version;
    u2             major_version;
    u2             constant_pool_count;
    cp_info        constant_pool[constant_pool_count-1];
    u2             access_flags;
    u2             this_class;
    u2             super_class;
    u2             interfaces_count;
    u2             interfaces[interfaces_count];
    u2             fields_count;
    field_info     fields[fields_count];
    u2             methods_count;
    method_info    methods[methods_count];
    u2             attributes_count;
    attribute_info attributes[attributes_count];
}
```

<img src="/Users/dexlace/private-github-repository/xmind-all/02_jvm/解析类文件结构.assets/image-20220925002441432.png" alt="image-20220925002441432" style="zoom: 33%;" />

```java
/**
 * 查看编译后的Class文件
 * 研究类文件结构
 * javac TestClass.java
 */
public class TestClass {
    private int m;

    public int inc(){
        return m+1;
    }
}
```



<img src="/Users/dexlace/private-github-repository/xmind-all/02_jvm/解析类文件结构.assets/image-20220924165203189.png" alt="image-20220924165203189" style="zoom: 33%;" />

## 魔数和class文件的版本

- **头四个字节**
- - **魔数**：0xcafebabe
- - 确定这个文件==是否为一个能被虚拟机接受的Class文件==

- **第5-8字节**
- - 第5和第6为次版本号
  - **第7和第8字段为主版本号**
  - JDK 1.1能支持版本号为45.0～45.65535的Class文件
  - JDK 1.2则能支持45.0～46.65535的Class文件
  - 上图中的次版本号为0
  - 上图中的主版本号为0x0034，即十进制的52

## 常量池

![image-20220924173209171](/Users/dexlace/private-github-repository/xmind-all/02_jvm/解析类文件结构.assets/image-20220924173209171.png)

## 访问标志

常量池结束之后，紧接着的2个字节代表访问标志（access_flags），这个标志用于识别一些类或者接口层次的访问信息，包括：这个Class是类还是接口；是否定义为public类型；是否定义为abstract 类型；如果是类的话，是否被声明为final；等等